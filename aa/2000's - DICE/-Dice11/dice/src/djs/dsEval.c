// --------------------------------------------------------------------------------// // Dice General Eval functions.// Keeping it simply and mapping directly to Macintosh/QuickTime API//// Copyright (c) 2005 John Henry Thompson. All rights reserved.//// -- History://// 2005.02.16	jht	Created.// // -------------------------------------------------------------------------------- #include "dsEval.h"#include "dicejs.h"#include "jsfun.h"#include "jsobj.h"#include "jscntxt.h"#include "jsutil.h" // --------------------------------------------------------------------------------static jsval	spendTimeFuncVal;static jsval	spendTime2FuncVal;const char * kSpendTimeStr = "spendTime";const char * kSpendTime2Str = "spendTime2";// --------------------------------------------------------------------------------// Check for change in global properties.//void ds_CheckGlobalChange(JSContext *cx, JSObject *glob ){	JSBool		ok = JS_FALSE;	jsval		funcVal = JSVAL_NULL;    ok = JS_GetProperty( cx, glob, kSpendTimeStr, &funcVal);	if (ok)	{		if (! JSVAL_IS_FUNCTION(cx, funcVal)  )		{			spendTimeFuncVal = JSVAL_NULL;		}		else		{			spendTimeFuncVal = funcVal;		}	}	    ok = JS_GetProperty( cx, glob, kSpendTime2Str, &funcVal);	if ( ok)	{		if (! JSVAL_IS_FUNCTION(cx, funcVal)  )		{			spendTime2FuncVal = JSVAL_NULL;		}		else		{			spendTime2FuncVal = funcVal;		}	}}// --------------------------------------------------------------------------------void ds_SpendTime(JSContext *cx, JSObject *glob ){	JSBool		ok = JS_FALSE;	long		nargs = 0;	jsval		*argv = 0;	jsval		rval;	if (spendTimeFuncVal)	{		ok = JS_CallFunctionValue( cx, JSVAL_TO_OBJECT( spendTimeFuncVal ), spendTimeFuncVal, 					nargs, argv, &rval);		if (! ok)		{			spendTimeFuncVal = 0;		}	}		if (spendTime2FuncVal)	{		ok = JS_CallFunctionValue( cx, JSVAL_TO_OBJECT( spendTime2FuncVal ), spendTime2FuncVal, 					nargs, argv, &rval);		if (! ok)		{			spendTime2FuncVal = 0;		}	}}// --------------------------------------------------------------------------------// --------------------------------------------------------------------------------