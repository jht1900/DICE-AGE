/* History:© 2001 John Henry Thompson. All rights reserved2001.05.22	jht	Split off.*/#include "CCapturePane.h"// ---------------------------------------------------------------------------------void	CCapturePane::ComputeMotionStreakEdge(){	int		capPix;	int 	diffwPix;	int		lastPos;	int		minHorPosDiff = 20;		const BitMap	*pSource; 	const BitMap	*pDest;	GrafPtr	myPort = GetMacPort();	PixMapHandle		pmapSourceHd;	PixMapHandle		pmapPreviousHd;	PixMapHandle		pmapMonitorHd;	int					hcount, vcount, width, height;	Rect				box;		UInt8*				sourcePtr; 	UInt8*				previousPtr; 	UInt8*				motionPtr; 		int					rowBytes;		UInt8*				sourceLinePtr;	UInt8*				previousLinePtr;	UInt8*				monitorLinePtr;		int					inside;		pmapSourceHd = GetGWorldPixMap(gwSourcePtr);	pmapPreviousHd = GetGWorldPixMap(gwPreviousPtr);	pmapMonitorHd = GetGWorldPixMap(gwMonitorPtr);		sourcePtr = (UInt8*)GetPixBaseAddr( pmapSourceHd );	previousPtr = (UInt8*)GetPixBaseAddr( pmapPreviousHd );	motionPtr = (UInt8*)GetPixBaseAddr( pmapMonitorHd );		rowBytes = (**pmapSourceHd).rowBytes & 0x3FFF;				box = (**pmapSourceHd).bounds;	width = box.right - box.left;	height = box.bottom - box.top;	motionPtr += width*4;	for (vcount = height; 		vcount > 0; 		vcount--, sourcePtr += rowBytes, previousPtr += rowBytes, motionPtr += rowBytes)	{		sourceLinePtr = sourcePtr+1;		previousLinePtr = previousPtr+1;		monitorLinePtr = motionPtr+1;				inside = 0;				lastPos = -1;				for (hcount =  width; 			hcount > 0; 			hcount--, sourceLinePtr+=4, previousLinePtr+=4, monitorLinePtr+=4)		{			/* Show line streak on change */ 			{ 				capPix = sourceLinePtr[0] + sourceLinePtr[1] + sourceLinePtr[2];   				diffwPix = (previousLinePtr[0] + previousLinePtr[1] + previousLinePtr[2]) - capPix;  				if (diffwPix < -diffTolerance_x3 || diffwPix > diffTolerance_x3) 				{ 					/* There is  difference */ 					if (lastPos < 0 || lastPos - hcount > minHorPosDiff)					{						inside = ! inside;						lastPos = hcount;					} 				} 				if (inside) 				{ 					/* Show image */ 					monitorLinePtr[0] = sourceLinePtr[0]; 					monitorLinePtr[1] = sourceLinePtr[1]; 					monitorLinePtr[2] = sourceLinePtr[2]; 				} 				else 				{ 					/* No diff, show black */ 					monitorLinePtr[0] = monitorLinePtr[1] = monitorLinePtr[2] = 0; 				} 			} 			/* Copy over for next diff */			previousLinePtr[0] = sourceLinePtr[0];			previousLinePtr[1] = sourceLinePtr[1];			previousLinePtr[2] = sourceLinePtr[2];		}	}	pSource = GetPortBitMapForCopyBits( gwMonitorPtr );	pDest = GetPortBitMapForCopyBits( myPort );	CopyBits( pSource, pDest, &captureRect, &drawRect, inkMode, 0);	gwLastOutput = gwMonitorPtr;}