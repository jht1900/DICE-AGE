/* History:Copyright © 2001 John Henry Thompson. All rights reserved2002.02.12	jht	Part of color meter.2001.05.22	jht	Split off.*/#include "CCapturePane.h"// ---------------------------------------------------------------------------------void	CCapturePane::ComputeAverage2(){	//const BitMap	*pSource;	//const BitMap	*pDest;	GrafPtr	myPort = GetMacPort();	PixMapHandle		pixMapHd;	PixMapHandle		pixMapAvgHd;	AVG_TYPE 				*avgBufPtr;	int					hcount, vcount, width, height;	Rect				box;		UInt8*				srcPtr;	UInt8*				dstPtr;		int					srcRowBytes, dstRowBytes;		UInt8*				srcLinePtr;	UInt8*				dstLinePtr;	AVG_TYPE			stillScale_m1 = stillScale-1;		pixMapHd = GetGWorldPixMap(gwSourcePtr);	pixMapAvgHd = GetGWorldPixMap(gwAvgPtr);		srcPtr = (UInt8*)GetPixBaseAddr( pixMapHd );	dstPtr = (UInt8*)GetPixBaseAddr( pixMapAvgHd );	srcRowBytes = (**pixMapHd).rowBytes & 0x3FFF;	dstRowBytes = (**pixMapAvgHd).rowBytes & 0x3FFF;		avgBufPtr = avgBufferPtr;		box = (**pixMapHd).bounds;	width = box.right - box.left;	height = box.bottom - box.top;	//dstPtr += width*4;		for (vcount = height; vcount > 0; vcount--, srcPtr += srcRowBytes, dstPtr += dstRowBytes)	{		srcLinePtr = srcPtr+1;		dstLinePtr = dstPtr+1;		for (hcount =  width; hcount > 0; hcount--, srcLinePtr+=4, dstLinePtr+=4, avgBufPtr+=3)		{#define DOIT(i) \				avgBufPtr[i] = (srcLinePtr[i] + avgBufPtr[i]*stillScale_m1)/stillScale; \				dstLinePtr[i] = avgBufPtr[i] 			DOIT(0);			DOIT(1);			DOIT(2);		}	}#if 0	/* Draw averge */	pSource = GetPortBitMapForCopyBits( gwAvgPtr );	pDest = GetPortBitMapForCopyBits( myPort );	CopyBits( pSource, pDest, &captureRect, &drawRect, inkMode, 0);		gwLastOutput = gwAvgPtr;#endif}