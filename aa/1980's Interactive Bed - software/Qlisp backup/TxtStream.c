/*Stream operations on Txt object.*/#include "qDef.h"#include "Stream.h"#include "TxtObj.h"#include "Obj.h"/* -------------------------------------------------------------------- */#define TRACE(a,b) /* printf b */extern TxtObj	*me;extern qItem	novalueSym;/* -------------------------------------------------------------------- */#define qTextStreamType 'TxtS'int StreamAlert(), ReadTxt1(), PrintTxt1();/* ---------------------- TxtRead_Stream ---------------------------- */qItem TxtRead_Stream()	{	register Stream	*s = &me->stream;	qItem			it = NIL;	TEPtr			te = *me->TEH;		HLock( te->hText );		if (te->selStart != te->selEnd)		me->expStart = te->selStart;		if (me->expStart >= te->teLength)		goto out;			s->type = qTextStreamType;	s->alertf = StreamAlert;	s->readf = ReadTxt1;	s->writef = PrintTxt1;	s->eofId = novalueSym;	s->fd = -1;	s->eofChar = '\r';	s->bufMax = te->teLength;	s->bufPos = me->expStart;	s->nread = te->teLength;	s->buf = *te->hText;		it = ReadStream( s);out:	me->expStart = te->teLength;		HUnlock( te->hText );		return (it);	}	/* ------------------------- TxtPrint_Stream ----------------------------*/qItem	TxtPrint_Stream(it)	qItem	it;	{	register Stream	*s = &me->stream;		s->type = qTextStreamType;	s->alertf = StreamAlert;	s->readf = ReadTxt1;	s->writef = PrintTxt1;		PrintStream(s, it);		TEInsert( "\r", 1L, me->TEH );		}	/* ------------------------ ReadTxt1 ----------------------------------- */	static	ReadTxt1(s)	register Stream	*s;	{	int				er;		s->bufPos = 0;	s->nread = 0;	}	/* ------------------------ PrintTxt1 --------------------------------- */	static	PrintTxt1(s, str, len)	register Stream	*s;	Byte			*str;	int				len;	{	long			count = len;		TRACE(1,("PrintTxt1: s=%lx str=%lx len=%d\n",s,str,len));		TEInsert( str, count, me->TEH );	}/* -------------------------------------------------------------------- */