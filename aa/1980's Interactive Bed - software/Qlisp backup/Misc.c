/**/#include <QuickDraw.h>#include <WindowMgr.h>#include <FileMgr.h>#include <StdFilePkg.h>#include <DialogMgr.h>#include <MenuMgr.h>#include <EventMgr.h>#include "qLispRsrc.h"#define TRACE(a,b) if (a < 2) printf b/* ---------------------------- AbortCheck ---------------------------- */AbortCheck()	{	EventRecord	myEvent;	#define abortEvent (mDownMask | keyDownMask)		if (GetNextEvent(abortEvent, &myEvent) == FALSE)		return (0);			return ( myEvent.what != nullEvent );	}	/* ---------------------------- FileSize -------------------------------*/long	FileSize(fn, vref)	Byte	*fn;	int		vref;	{	FileParam	fp;		fp.ioCompletion = 0;	fp.ioVRefNum = vref;	fp.ioNamePtr = fn;	fp.ioFVersNum = 0;	fp.ioFDirIndex = 0;	PBGetFInfo(&fp, FALSE);	return (fp.ioFlLgLen);	}	/* ------------------------- MyGrowZone -------------------------------- */static Handle	saftyBelt = 0;static pascal long MyGrowZone(needed)	long	needed;	{	if (! saftyBelt)		{		SysBeep(1);		return (0);		}	DisposHandle(saftyBelt);	saftyBelt = 0;	ShowCursor();	Alert(RunningOut, 0L);	return (1);	}	/* ------------------------- SetupGrowZone ----------------------------- */SetupGrowZone()	{	saftyBelt = NewHandle(2000L);	SetGrowZone(MyGrowZone);	}/* ----------------------- DoApple ------------------------------------- */DoApple(theItem)	{	DialogPtr	dp;	Str255		name;	extern MenuHandle	appleMenu;		if (theItem == 1)		{		dp = GetNewDialog(AboutBox, 0L, -1L);		if (! dp) return;		DrawDialog(dp);		while (! Button());		DisposDialog(dp);		}	else		{		GetItem(appleMenu, theItem, &name);		OpenDeskAcc( &name );		}	}	/* ---------------- SureAlloc ------------------------------------------ */Byte *SureAlloc(n)	long	n;	{	Byte	*p;	int		er;		p = (Byte *) NewPtr(n);	er = MemError();	if (er != noErr)		{		MemoryError(n, "\prun", er);		ExitToShell();		}	return (p);	}	/* -------------------------- MemoryError ----------------------------- */MemoryError(request, where, er)	long	request;	Byte	*where;	int		er;	{	Str255	need, avail;		ShowCursor();		NumToString(request, need);	NumToString(MaxBlock(), avail);	ParamText(where, need, avail, "\p");	Alert(AllocFailed, 0L);	}		/* -------------------------- FatalError ------------------------------ */	FatalError(p1, p2)	Byte	*p1, *p2;	{	ShowCursor();	ParamText(p1, p2, "\p", "\p");	Alert(PlainMsg, 0L);	ExitToShell();	}/* ---------------------- FileError ----------------------------------- */FileError(where, fn, er)	Str255 	where;	Str255	fn;	int		er;	{	Str255	numstr;		ShowCursor();		switch (er)		{		case -45: /* File is locked */			ParamText(where, fn, "\p", "\p");			Alert(FileLocked, 0L);			return;			break;		case -44: /* Volume is locked by hardeare setting */		case -46: /* Volume is locked by software flag */			ParamText(where, fn, "\p", "\p");			Alert(DiscProtected, 0L);			return;			break;		case -34: /* All allocation blocks on volume are full */			ParamText(where, fn, "\p", "\p");			Alert(DiscFull, 0L);			return;			break;		}				NumToString((long) er, numstr);	ParamText(numstr, where, fn, "\p");	Alert(DiscTrouble, 0L);	}/* ---------------------------------------------------------------------- */