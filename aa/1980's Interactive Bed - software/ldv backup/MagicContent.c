/**/#include <WindowMgr.h>#include <DialogMgr.h>#include <ControlMgr.h>#include <EventMgr.h>#include "DialogRes.h"#include "Magic.h"extern WindowPtr	myWin;static int scrollCode;pascal void ScrollProc();#define ref(c) ((int) (*c)->contrlRfCon)/* -------------------- MagicContent -------------------------------------- */MagicContent(evt)	EventRecord	*evt;	{	ControlHandle	theControl;		GlobalToLocal(&evt->where);		scrollCode = FindControl(evt->where, myWin, &theControl);		switch (scrollCode)		{		case inButton:			if (TrackControl(theControl, evt->where, 0L))				{				ButtonDispatch( ref(theControl), 1 );				}			break;		case inCheckBox:			if (TrackControl(theControl, evt->where, 0L))				{				int		n = GetCtlValue(theControl);								if (n) n = 0;				else n = 1;								SetCtlValue(theControl, n);								ButtonDispatch( ref(theControl), n );				}			break;								case inUpButton:		case inDownButton:		case inPageUp:		case inPageDown:			if (TrackControl(theControl, evt->where, &ScrollProc)) ;			break;		case inThumb:			if (TrackControl(theControl, evt->where, 0L))				{				ScrollProc(theControl, scrollCode);				}			break;		default:			break;		}	}	/* --------------------------------- ScrollProc ------------------------ */pascal void ScrollProc(theControl, theCode)	ControlHandle	theControl;	int				theCode;	{	int		val;	int		oval;	int		max;		if (theCode != scrollCode)		return;	SetPort(myWin);		oval = val = GetCtlValue(theControl);		switch (scrollCode)		{		case inUpButton:			val -= 1;			if (val < 0) val = 0;			break;		case inDownButton:			val += 1;			break;		case inPageUp:			val -= GetCtlMax(theControl) / 10;			if (val < 0) val = 0;			break;		case inPageDown:			val += (max = GetCtlMax(theControl)) / 10;			if (val > max)				val = max;			break;		}	SetCtlValue(theControl, val);		if (oval != val || scrollCode == inThumb)		ButtonDispatch( ref(theControl), val);	}	/* --------------------- ButtonDispatch ------------------------------- */extern Rect	vidRect;extern int grabbing;static ControlHandle	horCntl;static ControlHandle	verCntl;static ControlHandle	contrastCntl;ButtonDispatch(but, val)	{	switch (but)		{		case NextButton:			NextFrame();			break;		case Take1Button:			MagTakeOne();			break;		case TakeButton:			MagShow();			break;		case ResetButton:			MagHreset();			break;		case HorScroll:			MagHor(val);			break;		case VerScroll:			MagVer(val);			break;		case ContrastScroll:			MagHigh(val);			MagTakeOne();			break;		case LoopButton:			grabbing = val;			break;		}	}	/* --------------------------------------------------------------------- */#if 0MagReduce(val)	int	val;	{	val += 1;	MagNlines( 192 / val + 1);	MagNfields( 42 / val + 1);	MagStripOffset(12);	SetCtlValue(horCntl, 12);		MagStartLine(24);	SetCtlValue(verCntl, 24);	MagTakeOne();	}#endif	MagHor(val)	{	val += 1;	MagStripOffset(val);	MagTakeOne();	}	MagVer(val)	{	val += 1;	MagStartLine(val);	MagTakeOne();	}	/* -------------------------------------------------------------------- */ControlHandle	GetDitlControl();DitlTPtr		FindDitl();DitlTPtr		frameNump;SetupMagicBox()	{	GetDitlRect(VidArea, &vidRect);	horCntl = GetDitlControl(HorScroll);	verCntl = GetDitlControl(VerScroll);	contrastCntl = GetDitlControl(ContrastScroll);		SetCtlValue(horCntl, 12);	SetCtlValue(verCntl, 24);	SetCtlValue(contrastCntl, 40);		frameNump = FindDitl(FrameNumText);	}	FrameNum(n)	{	frameNump->info[frameNump->len-1] = '0' + n;	MakeStatText(frameNump);	}	/* -------------------------------------------------------------------- */